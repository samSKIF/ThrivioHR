Copy
Edit
Execute this EXACT task. Do not touch anything beyond what’s listed.
If any command fails, PRINT the error and STOP. Do not “fix” or scaffold.

GOAL
Finish removing the old `CIdentity` namespace from the identity repository by updating the remaining return type annotations.

TOUCH ONLY
apps/bff/src/modules/identity/identity.repository.ts

CHANGES
// apps/bff/src/modules/identity/identity.repository.ts
// Make sure we have a type import for UserPublic.
+import type { UserPublic } from '@thrivio/contracts';
- import { identity as CIdentity } from '@thrivio/contracts';

// Replace the return types on createUser and updateUserNames.
@@
-  async createUser(orgId: string, email: string, firstName: string|null, lastName: string|null): Promise<CIdentity.UserPublic> {
+  async createUser(orgId: string, email: string, firstName: string|null, lastName: string|null): Promise<UserPublic> {
@@
-  async updateUserNames(userId: string, firstName: string|null, lastName: string|null): Promise<CIdentity.UserPublic> {
+  async updateUserNames(userId: string, firstName: string|null, lastName: string|null): Promise<UserPublic> {

RUN & PRINT
# Try building the BFF
npx nx build bff && echo "=== BUILD OK ==="

# Smoke test: login, create import session, preview
ORG_ID=$(curl -s 'http://localhost:5000/orgs?limit=1' | grep -o '"id":"[^"]*"' | head -1 | cut -d'"' -f4)
LOGIN=$(curl -s -X POST http://localhost:5000/auth/login -H 'content-type: application/json' \
  -d "{\"orgId\":\"$ORG_ID\",\"email\":\"csvdemo@example.com\"}")
ACCESS=$(echo "$LOGIN" | grep -o '"accessToken":"[^"]*"' | cut -d'"' -f4)
SESSION=$(curl -s -X POST http://localhost:5000/directory/import/session \
  -H "content-type: application/json" -H "Authorization: Bearer $ACCESS" \
  -d '{"csv":"email,givenName,familyName,department\nalex@demo.com,Alex,Stone,Engineering"}')
TOKEN=$(echo "$SESSION" | grep -o '"token":"[^"]*"' | cut -d'"' -f4)
curl -s "http://localhost:5000/directory/import/session/preview?token=$TOKEN" \
  -H "Authorization: Bearer $ACCESS" | head -80

# Status question
echo "=== STATUS QUESTION ==="
echo "Replit, confirm: all CIdentity references removed and build passes; where are we vs the roadmap and any regressions?"

STOP.
